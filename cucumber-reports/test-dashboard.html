<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Test Results Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --pending: #8b5cf6;
            --pending-light: #ede9fe;
            --skipped: #6b7280;
            --skipped-light: #f3f4f6;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text span {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .data-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            font-size: 0.875rem;
            color: var(--success);
        }

        .data-badge.demo {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.3);
            color: var(--warning);
        }

        .timestamp {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Summary Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.total::before { background: var(--gradient-1); }
        .stat-card.passed::before { background: var(--gradient-success); }
        .stat-card.failed::before { background: var(--gradient-danger); }
        .stat-card.pending::before { background: var(--gradient-warning); }
        .stat-card.skipped::before { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .stat-card.total .stat-icon { background: rgba(99, 102, 241, 0.2); color: var(--primary); }
        .stat-card.passed .stat-icon { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .stat-card.failed .stat-icon { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .stat-card.pending .stat-icon { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .stat-card.skipped .stat-icon { background: rgba(107, 114, 128, 0.2); color: var(--skipped); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-card.passed .stat-value { color: var(--success); }
        .stat-card.failed .stat-value { color: var(--danger); }
        .stat-card.pending .stat-value { color: var(--warning); }
        .stat-card.skipped .stat-value { color: var(--skipped); }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-percentage {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
        }

        .stat-card.passed .stat-percentage { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .stat-card.failed .stat-percentage { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        /* Visual Progress Section */
        .visual-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .progress-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .progress-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Circular Progress */
        .circular-progress-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .circular-progress {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .circular-progress svg {
            transform: rotate(-90deg);
            width: 200px;
            height: 200px;
        }

        .circular-progress circle {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
        }

        .circular-progress .bg {
            stroke: var(--border-color);
        }

        .circular-progress .progress-passed {
            stroke: var(--success);
            stroke-dasharray: 565.48;
            stroke-dashoffset: 565.48;
            transition: stroke-dashoffset 1s ease;
        }

        .circular-progress .progress-failed {
            stroke: var(--danger);
            stroke-dasharray: 565.48;
            stroke-dashoffset: 565.48;
            transition: stroke-dashoffset 1s ease;
        }

        .circular-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .circular-progress-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--success);
        }

        .circular-progress-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Bar Chart */
        .bar-chart {
            padding: 1rem 0;
        }

        .bar-item {
            margin-bottom: 1.5rem;
        }

        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .bar-name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .bar-name i {
            width: 20px;
        }

        .bar-value {
            font-weight: 600;
        }

        .bar-track {
            height: 12px;
            background: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1s ease;
        }

        .bar-fill.passed { background: var(--gradient-success); }
        .bar-fill.failed { background: var(--gradient-danger); }
        .bar-fill.pending { background: var(--gradient-warning); }
        .bar-fill.skipped { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }

        /* Module Cards */
        .modules-section {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .module-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .module-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .module-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .module-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
        }

        .module-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .module-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .module-stat {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.8rem;
        }

        .module-stat.passed { color: var(--success); }
        .module-stat.failed { color: var(--danger); }
        .module-stat.pending { color: var(--warning); }

        .module-progress {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
        }

        .module-progress-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .module-pass-rate {
            text-align: right;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* Test Results Table */
        .results-section {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .results-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            flex: 1;
            max-width: 400px;
        }

        .search-box i {
            color: var(--text-secondary);
            margin-right: 0.75rem;
        }

        .search-box input {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 0.875rem;
            width: 100%;
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--text-secondary);
        }

        .filters {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .filter-btn .count {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .filter-btn.active .count {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Table */
        .results-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table th {
            text-align: left;
            padding: 1rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--border-color);
        }

        .results-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.875rem;
        }

        .results-table tbody tr {
            transition: background 0.2s ease;
        }

        .results-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .scenario-name {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .scenario-title {
            font-weight: 500;
            color: var(--text-primary);
        }

        .scenario-feature {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.passed {
            background: var(--success-light);
            color: #065f46;
        }

        .status-badge.failed {
            background: var(--danger-light);
            color: #991b1b;
        }

        .status-badge.pending {
            background: var(--warning-light);
            color: #92400e;
        }

        .status-badge.skipped {
            background: var(--skipped-light);
            color: #374151;
        }

        .duration {
            color: var(--text-secondary);
        }

        .module-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .visual-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .results-header {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                max-width: none;
            }

            .filters {
                flex-wrap: wrap;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-card, .module-card, .progress-card {
            animation: fadeIn 0.5s ease forwards;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        .stat-card:nth-child(5) { animation-delay: 0.5s; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-cloud"></i>
                </div>
                <div class="logo-text">
                    <h1>Salesforce Test Dashboard</h1>
                    <span>Automated Test Results</span>
                </div>
            </div>
            <div class="header-meta">
                <div class="data-badge" id="dataBadge">
                    <i class="fas fa-database"></i>
                    <span>Loading...</span>
                </div>
                <div class="timestamp" id="timestamp">
                    <i class="far fa-clock"></i>
                    <span></span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Summary Stats -->
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="stat-icon"><i class="fas fa-list-check"></i></div>
                <div class="stat-value" id="totalTests">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card passed">
                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Passed</div>
                <div class="stat-percentage" id="passedPercentage">0%</div>
            </div>
            <div class="stat-card failed">
                <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Failed</div>
                <div class="stat-percentage" id="failedPercentage">0%</div>
            </div>
            <div class="stat-card pending">
                <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                <div class="stat-value" id="pendingTests">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card skipped">
                <div class="stat-icon"><i class="fas fa-forward"></i></div>
                <div class="stat-value" id="skippedTests">0</div>
                <div class="stat-label">Skipped</div>
            </div>
        </div>

        <!-- Visual Progress -->
        <div class="visual-section">
            <div class="progress-card">
                <h3><i class="fas fa-chart-bar"></i> Test Results Distribution</h3>
                <div class="bar-chart" id="barChart">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="progress-card">
                <h3><i class="fas fa-chart-pie"></i> Pass Rate</h3>
                <div class="circular-progress-container">
                    <div class="circular-progress">
                        <svg viewBox="0 0 200 200">
                            <circle class="bg" cx="100" cy="100" r="90"></circle>
                            <circle class="progress-passed" id="circleProgress" cx="100" cy="100" r="90"></circle>
                        </svg>
                        <div class="circular-progress-text">
                            <div class="circular-progress-value" id="passRateValue">0%</div>
                            <div class="circular-progress-label">Pass Rate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modules Section -->
        <div class="modules-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-cubes"></i> Test Modules</h2>
            </div>
            <div class="modules-grid" id="modulesGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Test Results Table -->
        <div class="results-section">
            <div class="results-header">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search scenarios...">
                </div>
                <div class="filters" id="filters">
                    <button class="filter-btn active" data-filter="all">
                        All <span class="count" id="filterAll">0</span>
                    </button>
                    <button class="filter-btn" data-filter="passed">
                        <i class="fas fa-check"></i> Passed <span class="count" id="filterPassed">0</span>
                    </button>
                    <button class="filter-btn" data-filter="failed">
                        <i class="fas fa-times"></i> Failed <span class="count" id="filterFailed">0</span>
                    </button>
                    <button class="filter-btn" data-filter="pending">
                        <i class="fas fa-clock"></i> Pending <span class="count" id="filterPending">0</span>
                    </button>
                </div>
            </div>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Module</th>
                        <th>Status</th>
                        <th>Duration</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                    <!-- Populated by JS -->
                </tbody>
            </table>
            <div class="empty-state" id="emptyState" style="display: none;">
                <i class="fas fa-search"></i>
                <h3>No scenarios found</h3>
                <p>Try adjusting your search or filters</p>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allScenarios = [];
        let currentFilter = 'all';
        let searchQuery = '';

        // Module definitions with icons and colors
        const moduleConfig = {
            'CustomerData': { icon: 'fa-users', color: '#6366f1', name: 'Customer Data' },
            'Finance': { icon: 'fa-dollar-sign', color: '#10b981', name: 'Finance' },
            'Inventory': { icon: 'fa-boxes', color: '#f59e0b', name: 'Inventory' },
            'Marketing': { icon: 'fa-bullhorn', color: '#ec4899', name: 'Marketing' },
            'OtherFunctionality': { icon: 'fa-cog', color: '#8b5cf6', name: 'Other Functionality' },
            'Platform': { icon: 'fa-server', color: '#14b8a6', name: 'Platform' },
            'Sales': { icon: 'fa-chart-line', color: '#3b82f6', name: 'Sales' },
            'Service': { icon: 'fa-headset', color: '#f97316', name: 'Service' }
        };

        // Initialize dashboard
        async function init() {
            try {
                const response = await fetch('cucumber-report.json');
                if (response.ok) {
                    const data = await response.json();
                    processReportData(data);
                    updateDataBadge(true);
                } else {
                    loadDemoData();
                    updateDataBadge(false);
                }
            } catch (error) {
                console.log('Loading demo data:', error);
                loadDemoData();
                updateDataBadge(false);
            }

            setupEventListeners();
            updateTimestamp();
        }

        // Process cucumber report data
        function processReportData(data) {
            allScenarios = [];

            data.forEach(feature => {
                const uri = feature.uri || '';
                const module = detectModule(uri, feature.tags || []);

                if (feature.elements) {
                    feature.elements.forEach(element => {
                        if (element.type === 'scenario' || element.keyword === 'Scenario Outline' || element.keyword === 'Scenario') {
                            const status = getScenarioStatus(element);
                            const duration = getScenarioDuration(element);

                            allScenarios.push({
                                name: element.name || 'Unnamed Scenario',
                                feature: feature.name || 'Unnamed Feature',
                                module: module,
                                status: status,
                                duration: duration
                            });
                        }
                    });
                }
            });

            updateDashboard();
        }

        // Detect module from URI or tags
        function detectModule(uri, tags) {
            const uriLower = uri.toLowerCase();
            const tagNames = tags.map(t => (t.name || '').toLowerCase());

            for (const [key, value] of Object.entries(moduleConfig)) {
                if (uriLower.includes(key.toLowerCase()) || 
                    tagNames.some(t => t.includes(key.toLowerCase()))) {
                    return key;
                }
            }

            // Try common patterns
            if (uriLower.includes('customer') || tagNames.includes('@customer')) return 'CustomerData';
            if (uriLower.includes('finance') || tagNames.includes('@finance')) return 'Finance';
            if (uriLower.includes('inventory') || tagNames.includes('@inventory')) return 'Inventory';
            if (uriLower.includes('marketing') || tagNames.includes('@marketing')) return 'Marketing';
            if (uriLower.includes('platform') || tagNames.includes('@platform')) return 'Platform';
            if (uriLower.includes('sales') || tagNames.includes('@sales')) return 'Sales';
            if (uriLower.includes('service') || tagNames.includes('@service')) return 'Service';

            return 'OtherFunctionality';
        }

        // Get scenario status from steps
        function getScenarioStatus(element) {
            if (!element.steps || element.steps.length === 0) return 'pending';

            let hasFailure = false;
            let hasPending = false;
            let hasSkipped = false;
            let hasPassed = false;

            element.steps.forEach(step => {
                const status = step.result?.status?.toLowerCase() || 'pending';
                if (status === 'failed') hasFailure = true;
                else if (status === 'pending' || status === 'undefined') hasPending = true;
                else if (status === 'skipped') hasSkipped = true;
                else if (status === 'passed') hasPassed = true;
            });

            if (hasFailure) return 'failed';
            if (hasPending) return 'pending';
            if (hasSkipped && !hasPassed) return 'skipped';
            return 'passed';
        }

        // Get scenario duration
        function getScenarioDuration(element) {
            if (!element.steps) return 0;

            let totalDuration = 0;
            element.steps.forEach(step => {
                if (step.result?.duration) {
                    totalDuration += step.result.duration;
                }
            });

            return totalDuration / 1000000000; // Convert nanoseconds to seconds
        }

        // Load demo data
        function loadDemoData() {
            allScenarios = [
                // CustomerData
                { name: 'Create Individual Record', feature: 'Individual Management', module: 'CustomerData', status: 'passed', duration: 45.2 },
                { name: 'Update Contact Information', feature: 'Contact Management', module: 'CustomerData', status: 'passed', duration: 32.1 },
                { name: 'Authorization Form Consent', feature: 'Authorization Form', module: 'CustomerData', status: 'passed', duration: 38.5 },
                { name: 'Communication Subscription', feature: 'Subscriptions', module: 'CustomerData', status: 'passed', duration: 41.3 },
                
                // Finance
                { name: 'Create Alternative Payment', feature: 'Payment Processing', module: 'Finance', status: 'passed', duration: 52.1 },
                { name: 'Process Refund', feature: 'Payment Processing', module: 'Finance', status: 'passed', duration: 48.7 },
                { name: 'Generate Invoice', feature: 'Billing', module: 'Finance', status: 'passed', duration: 35.2 },
                { name: 'Apply Discount', feature: 'Billing', module: 'Finance', status: 'passed', duration: 28.4 },
                
                // Inventory
                { name: 'Create Location Group', feature: 'Location Management', module: 'Inventory', status: 'passed', duration: 42.8 },
                { name: 'Update Stock Levels', feature: 'Stock Management', module: 'Inventory', status: 'passed', duration: 36.5 },
                { name: 'Transfer Inventory', feature: 'Stock Management', module: 'Inventory', status: 'failed', duration: 55.2 },
                { name: 'Generate Report', feature: 'Reporting', module: 'Inventory', status: 'pending', duration: 0 },
                
                // Marketing
                { name: 'Create Campaign', feature: 'Campaign Management', module: 'Marketing', status: 'passed', duration: 44.1 },
                { name: 'Email Template', feature: 'Email Marketing', module: 'Marketing', status: 'passed', duration: 31.8 },
                { name: 'Lead Scoring', feature: 'Lead Management', module: 'Marketing', status: 'failed', duration: 62.3 },
                { name: 'Social Integration', feature: 'Social Media', module: 'Marketing', status: 'pending', duration: 0 },
                
                // OtherFunctionality
                { name: 'Appointment Categories', feature: 'Appointments', module: 'OtherFunctionality', status: 'passed', duration: 39.2 },
                { name: 'Calendar Events', feature: 'Calendar', module: 'OtherFunctionality', status: 'passed', duration: 28.7 },
                { name: 'Catalog Items', feature: 'Catalog', module: 'OtherFunctionality', status: 'passed', duration: 45.1 },
                { name: 'Contract Management', feature: 'Contracts', module: 'OtherFunctionality', status: 'passed', duration: 52.4 },
                { name: 'File Uploads', feature: 'Files', module: 'OtherFunctionality', status: 'passed', duration: 33.8 },
                { name: 'Scorecard Creation', feature: 'Scorecards', module: 'OtherFunctionality', status: 'passed', duration: 41.2 },
                
                // Platform
                { name: 'User Creation', feature: 'User Management', module: 'Platform', status: 'passed', duration: 35.6 },
                { name: 'Role Assignment', feature: 'Roles & Permissions', module: 'Platform', status: 'passed', duration: 28.9 },
                { name: 'Profile Configuration', feature: 'Profiles', module: 'Platform', status: 'passed', duration: 42.1 },
                { name: 'Permission Sets', feature: 'Roles & Permissions', module: 'Platform', status: 'passed', duration: 38.4 },
                
                // Sales
                { name: 'Create Account', feature: 'Account Management', module: 'Sales', status: 'passed', duration: 46.2 },
                { name: 'Create Opportunity', feature: 'Opportunity Management', module: 'Sales', status: 'passed', duration: 51.8 },
                { name: 'Convert Lead', feature: 'Lead Management', module: 'Sales', status: 'passed', duration: 58.3 },
                { name: 'Price Book Entry', feature: 'Price Books', module: 'Sales', status: 'failed', duration: 65.1 },
                { name: 'Quote Generation', feature: 'Quotes', module: 'Sales', status: 'pending', duration: 0 },
                
                // Service
                { name: 'Create Case', feature: 'Case Management', module: 'Service', status: 'passed', duration: 42.5 },
                { name: 'Change Request', feature: 'Change Requests', module: 'Service', status: 'passed', duration: 38.9 },
                { name: 'Knowledge Article', feature: 'Knowledge Base', module: 'Service', status: 'passed', duration: 35.2 }
            ];

            updateDashboard();
        }

        // Update entire dashboard
        function updateDashboard() {
            updateStats();
            updateCircularProgress();
            updateBarChart();
            updateModulesGrid();
            updateResultsTable();
        }

        // Update statistics
        function updateStats() {
            const total = allScenarios.length;
            const passed = allScenarios.filter(s => s.status === 'passed').length;
            const failed = allScenarios.filter(s => s.status === 'failed').length;
            const pending = allScenarios.filter(s => s.status === 'pending').length;
            const skipped = allScenarios.filter(s => s.status === 'skipped').length;

            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('pendingTests').textContent = pending;
            document.getElementById('skippedTests').textContent = skipped;

            const passedPct = total > 0 ? Math.round((passed / total) * 100) : 0;
            const failedPct = total > 0 ? Math.round((failed / total) * 100) : 0;

            document.getElementById('passedPercentage').textContent = passedPct + '%';
            document.getElementById('failedPercentage').textContent = failedPct + '%';

            // Update filter counts
            document.getElementById('filterAll').textContent = total;
            document.getElementById('filterPassed').textContent = passed;
            document.getElementById('filterFailed').textContent = failed;
            document.getElementById('filterPending').textContent = pending;
        }

        // Update circular progress
        function updateCircularProgress() {
            const total = allScenarios.length;
            const passed = allScenarios.filter(s => s.status === 'passed').length;
            const passRate = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('passRateValue').textContent = passRate + '%';

            const circle = document.getElementById('circleProgress');
            const circumference = 2 * Math.PI * 90; // r=90
            const offset = circumference - (passRate / 100) * circumference;
            
            setTimeout(() => {
                circle.style.strokeDashoffset = offset;
            }, 100);
        }

        // Update bar chart
        function updateBarChart() {
            const total = allScenarios.length;
            const passed = allScenarios.filter(s => s.status === 'passed').length;
            const failed = allScenarios.filter(s => s.status === 'failed').length;
            const pending = allScenarios.filter(s => s.status === 'pending').length;
            const skipped = allScenarios.filter(s => s.status === 'skipped').length;

            const data = [
                { label: 'Passed', value: passed, class: 'passed', icon: 'fa-check-circle', color: 'var(--success)' },
                { label: 'Failed', value: failed, class: 'failed', icon: 'fa-times-circle', color: 'var(--danger)' },
                { label: 'Pending', value: pending, class: 'pending', icon: 'fa-hourglass-half', color: 'var(--warning)' },
                { label: 'Skipped', value: skipped, class: 'skipped', icon: 'fa-forward', color: 'var(--skipped)' }
            ];

            const maxValue = Math.max(...data.map(d => d.value), 1);
            const container = document.getElementById('barChart');
            container.innerHTML = data.map(item => `
                <div class="bar-item">
                    <div class="bar-label">
                        <span class="bar-name" style="color: ${item.color}">
                            <i class="fas ${item.icon}"></i>
                            ${item.label}
                        </span>
                        <span class="bar-value" style="color: ${item.color}">${item.value}</span>
                    </div>
                    <div class="bar-track">
                        <div class="bar-fill ${item.class}" style="width: ${(item.value / maxValue) * 100}%"></div>
                    </div>
                </div>
            `).join('');
        }

        // Update modules grid
        function updateModulesGrid() {
            const moduleStats = {};

            // Calculate stats for each module
            allScenarios.forEach(scenario => {
                if (!moduleStats[scenario.module]) {
                    moduleStats[scenario.module] = { total: 0, passed: 0, failed: 0, pending: 0 };
                }
                moduleStats[scenario.module].total++;
                moduleStats[scenario.module][scenario.status]++;
            });

            const container = document.getElementById('modulesGrid');
            container.innerHTML = Object.entries(moduleStats).map(([module, stats]) => {
                const config = moduleConfig[module] || { icon: 'fa-folder', color: '#6b7280', name: module };
                const passRate = stats.total > 0 ? Math.round((stats.passed / stats.total) * 100) : 0;

                return `
                    <div class="module-card" onclick="filterByModule('${module}')">
                        <div class="module-header">
                            <div class="module-icon" style="background: ${config.color}20; color: ${config.color}">
                                <i class="fas ${config.icon}"></i>
                            </div>
                            <div class="module-name">${config.name}</div>
                        </div>
                        <div class="module-stats">
                            <div class="module-stat passed"><i class="fas fa-check"></i> ${stats.passed}</div>
                            <div class="module-stat failed"><i class="fas fa-times"></i> ${stats.failed}</div>
                            <div class="module-stat pending"><i class="fas fa-clock"></i> ${stats.pending || 0}</div>
                        </div>
                        <div class="module-progress">
                            <div class="module-progress-fill" style="width: ${passRate}%"></div>
                        </div>
                        <div class="module-pass-rate">${passRate}% pass rate (${stats.total} tests)</div>
                    </div>
                `;
            }).join('');
        }

        // Update results table
        function updateResultsTable() {
            let filtered = allScenarios;

            // Apply status filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(s => s.status === currentFilter);
            }

            // Apply search filter
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(s => 
                    s.name.toLowerCase().includes(query) ||
                    s.feature.toLowerCase().includes(query) ||
                    s.module.toLowerCase().includes(query)
                );
            }

            const container = document.getElementById('resultsBody');
            const emptyState = document.getElementById('emptyState');

            if (filtered.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = filtered.map(scenario => {
                const config = moduleConfig[scenario.module] || { name: scenario.module };
                const duration = scenario.duration > 0 
                    ? `${scenario.duration.toFixed(1)}s` 
                    : '-';

                return `
                    <tr>
                        <td>
                            <div class="scenario-name">
                                <span class="scenario-title">${scenario.name}</span>
                                <span class="scenario-feature">${scenario.feature}</span>
                            </div>
                        </td>
                        <td><span class="module-tag">${config.name}</span></td>
                        <td>
                            <span class="status-badge ${scenario.status}">
                                <i class="fas ${getStatusIcon(scenario.status)}"></i>
                                ${scenario.status}
                            </span>
                        </td>
                        <td class="duration">${duration}</td>
                    </tr>
                `;
            }).join('');
        }

        // Get status icon
        function getStatusIcon(status) {
            switch (status) {
                case 'passed': return 'fa-check';
                case 'failed': return 'fa-times';
                case 'pending': return 'fa-clock';
                case 'skipped': return 'fa-forward';
                default: return 'fa-question';
            }
        }

        // Filter by module
        function filterByModule(module) {
            document.getElementById('searchInput').value = module;
            searchQuery = module;
            updateResultsTable();
        }

        // Update data badge
        function updateDataBadge(isLive) {
            const badge = document.getElementById('dataBadge');
            if (isLive) {
                badge.innerHTML = '<i class="fas fa-database"></i><span>Live Data</span>';
                badge.classList.remove('demo');
            } else {
                badge.innerHTML = '<i class="fas fa-flask"></i><span>Demo Data</span>';
                badge.classList.add('demo');
            }
        }

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').innerHTML = `
                <i class="far fa-clock"></i>
                <span>${now.toLocaleDateString()} ${now.toLocaleTimeString()}</span>
            `;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search input
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchQuery = e.target.value;
                updateResultsTable();
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    updateResultsTable();
                });
            });
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
