<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Salesforce Test Results Dashboard v2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --success: #10b981;
        --success-light: #d1fae5;
        --danger: #ff3b3b;
        --danger-light: #ffd6d6;
        --warning: #f59e0b;
        --warning-light: #fef3c7;
        --pending: #8b5cf6;
        --pending-light: #ede9fe;
        --skipped: #6b7280;
        --skipped-light: #f3f4f6;
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-card: #1e293b;
        --bg-card-hover: #273548;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --border-color: #334155;
        --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --gradient-danger: linear-gradient(135deg, #ff3b3b 0%, #e60000 100%);
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--bg-primary);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.3s ease;
      }

      .loading-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--border-color);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .loading-text {
        margin-top: 1rem;
        color: var(--text-secondary);
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }

      /* Header */
      .header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem 2rem;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-content {
        max-width: 1600px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo-icon {
        width: 48px;
        height: 48px;
        background: var(--gradient-1);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .logo-text h1 {
        font-size: 1.5rem;
        font-weight: 700;
      }

      .logo-text span {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .header-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }

      .data-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(16, 185, 129, 0.2);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 20px;
        font-size: 0.875rem;
        color: var(--success);
      }

      .data-badge.demo {
        background: rgba(245, 158, 11, 0.2);
        border-color: rgba(245, 158, 11, 0.3);
        color: var(--warning);
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--bg-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-4px);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
      }

      .stat-card.total::before {
        background: var(--gradient-1);
      }
      .stat-card.passed::before {
        background: var(--gradient-success);
      }
      .stat-card.failed::before {
        background: var(--gradient-danger);
      }
      .stat-card.pending::before {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }
      .stat-card.skipped::before {
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      }

      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        margin-bottom: 1rem;
      }

      .stat-card.total .stat-icon {
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary);
      }
      .stat-card.passed .stat-icon {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
      }
      .stat-card.failed .stat-icon {
        background: rgba(255, 59, 59, 0.25);
        color: var(--danger);
      }
      .stat-card.pending .stat-icon {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
      }
      .stat-card.skipped .stat-icon {
        background: rgba(107, 114, 128, 0.2);
        color: var(--skipped);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        line-height: 1;
        margin-bottom: 0.5rem;
      }

      .stat-card.passed .stat-value {
        color: var(--success);
      }
      .stat-card.failed .stat-value {
        color: var(--danger);
      }
      .stat-card.pending .stat-value {
        color: var(--warning);
      }
      .stat-card.skipped .stat-value {
        color: var(--skipped);
      }

      .stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .stat-percentage {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
      }

      .stat-card.passed .stat-percentage {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
      }
      .stat-card.failed .stat-percentage {
        background: rgba(255, 59, 59, 0.25);
        color: var(--danger);
      }

      /* Parent Modules Section */
      .parent-modules-section {
        margin-bottom: 2rem;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* Parent Module Card */
      .parent-module {
        background: var(--bg-card);
        border-radius: 16px;
        border: 1px solid var(--border-color);
        margin-bottom: 1rem;
        overflow: hidden;
      }

      .parent-module-header {
        padding: 1.25rem 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .parent-module-header:hover {
        background: var(--bg-card-hover);
      }

      .parent-module-info {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .parent-module-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
      }

      .parent-module-details h3 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }

      .parent-module-meta {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      .inner-module-count {
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary);
        padding: 0.125rem 0.5rem;
        border-radius: 10px;
        font-weight: 500;
      }

      .parent-module-stats {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }

      .parent-stat {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .parent-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
      }

      .parent-stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
      }

      .parent-stat.passed .parent-stat-value {
        color: var(--success);
      }
      .parent-stat.failed .parent-stat-value {
        color: var(--danger);
      }
      .parent-stat.total .parent-stat-value {
        color: var(--primary);
      }

      .parent-module-toggle {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: var(--bg-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.3s ease;
      }

      .parent-module.expanded .parent-module-toggle {
        transform: rotate(180deg);
      }

      /* Inner Modules */
      .inner-modules {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: rgba(0, 0, 0, 0.2);
      }

      .parent-module.expanded .inner-modules {
        max-height: 2000px;
      }

      .inner-modules-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1rem;
        padding: 1rem 1.5rem 1.5rem;
      }

      .inner-module-card {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        border: 1px solid var(--border-color);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .inner-module-card:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
      }

      .inner-module-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.75rem;
      }

      .inner-module-name {
        font-weight: 600;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .inner-module-name i {
        font-size: 0.8rem;
        opacity: 0.7;
      }

      .inner-module-stats {
        display: flex;
        gap: 0.75rem;
      }

      .inner-stat {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .inner-stat.passed {
        color: var(--success);
      }
      .inner-stat.failed {
        color: var(--danger);
      }
      .inner-stat.pending {
        color: var(--warning);
      }
      .inner-stat.skipped {
        color: var(--skipped);
      }

      .inner-module-card.has-failures {
        color: red;
        border-color: rgba(255, 59, 59, 0.6);
        box-shadow: 0 0 8px rgba(255, 59, 59, 0.3);
      }

      /* .parent-module.has-failures {
        box-shadow: 0 0 20px 5px red;
      } */

      .parent-module.has-failures .parent-module-header {
        border-left: 4px solid var(--danger);
      }

      .inner-module-progress {
        height: 6px;
        background: var(--border-color);
        border-radius: 3px;
        overflow: hidden;
      }

      .inner-module-progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.5s ease;
      }

      .inner-module-progress-fill.high {
        background: var(--gradient-success);
      }
      .inner-module-progress-fill.medium {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }
      .inner-module-progress-fill.low {
        background: var(--gradient-danger);
      }

      .inner-module-footer {
        display: flex;
        justify-content: space-between;
        margin-top: 0.5rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      /* Results Table Section */
      .results-section {
        background: var(--bg-card);
        border-radius: 16px;
        border: 1px solid var(--border-color);
        overflow: hidden;
      }

      .results-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .search-box {
        display: flex;
        align-items: center;
        background: var(--bg-primary);
        border-radius: 8px;
        padding: 0.5rem 1rem;
        border: 1px solid var(--border-color);
        flex: 1;
        max-width: 400px;
      }

      .search-box i {
        color: var(--text-secondary);
        margin-right: 0.75rem;
      }

      .search-box input {
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 0.875rem;
        width: 100%;
        outline: none;
      }

      .filters {
        display: flex;
        gap: 0.5rem;
      }

      .filter-btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: var(--bg-primary);
        color: var(--text-secondary);
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.375rem;
      }

      .filter-btn:hover {
        border-color: var(--primary);
        color: var(--text-primary);
      }

      .filter-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
      }

      .filter-btn .count {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.125rem 0.5rem;
        border-radius: 10px;
        font-size: 0.75rem;
      }

      /* Table */
      .results-table {
        width: 100%;
        border-collapse: collapse;
      }

      .results-table th {
        text-align: left;
        padding: 1rem 1.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-secondary);
        background: rgba(0, 0, 0, 0.2);
        border-bottom: 1px solid var(--border-color);
      }

      .results-table td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        font-size: 0.875rem;
      }

      .results-table tbody tr:hover {
        background: rgba(99, 102, 241, 0.05);
      }

      .scenario-name {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .scenario-title {
        font-weight: 500;
      }

      .scenario-feature {
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-badge.passed {
        background: var(--success-light);
        color: #065f46;
      }
      .status-badge.failed {
        background: #ff3b3b;
        color: #ffffff;
        font-weight: 700;
      }
      .status-badge.pending {
        background: var(--warning-light);
        color: #92400e;
      }
      .status-badge.skipped {
        background: var(--skipped-light);
        color: #374151;
      }

      .module-tag {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary);
        border-radius: 4px;
        font-size: 0.75rem;
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-secondary);
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .empty-state h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .stats-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .parent-module-stats {
          flex-wrap: wrap;
          gap: 1rem;
        }
        .results-header {
          flex-direction: column;
        }
        .search-box {
          max-width: none;
        }
        .filters {
          flex-wrap: wrap;
        }
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card,
      .parent-module {
        animation: fadeIn 0.5s ease forwards;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon"><i class="fas fa-cloud"></i></div>
          <div class="logo-text">
            <h1>Salesforce Test Dashboard</h1>
            <span>Hierarchical Test Results View</span>
          </div>
        </div>
        <div class="header-meta">
          <div class="data-badge" id="dataBadge">
            <i class="fas fa-database"></i>
            <span>Loading...</span>
          </div>
          <div
            id="timestamp"
            style="font-size: 0.875rem; color: var(--text-secondary)"
          >
            <i class="far fa-clock"></i> <span></span>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
      <!-- Summary Stats -->
      <div class="stats-grid">
        <div class="stat-card total">
          <div class="stat-icon"><i class="fas fa-list-check"></i></div>
          <div class="stat-value" id="totalTests">0</div>
          <div class="stat-label">Total Tests</div>
        </div>
        <div class="stat-card passed">
          <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
          <div class="stat-value" id="passedTests">0</div>
          <div class="stat-label">Passed</div>
          <div class="stat-percentage" id="passedPercentage">0%</div>
        </div>
        <div class="stat-card failed">
          <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
          <div class="stat-value" id="failedTests">0</div>
          <div class="stat-label">Failed</div>
          <div class="stat-percentage" id="failedPercentage">0%</div>
        </div>
        <div class="stat-card pending">
          <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
          <div class="stat-value" id="pendingTests">0</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card skipped">
          <div class="stat-icon"><i class="fas fa-forward"></i></div>
          <div class="stat-value" id="skippedTests">0</div>
          <div class="stat-label">Skipped</div>
        </div>
      </div>

      <!-- Parent Modules Section -->
      <div class="parent-modules-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-folder-tree"></i> Test Modules Hierarchy
          </h2>
        </div>
        <div id="parentModulesContainer">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Results Table -->
      <div class="results-section">
        <div class="results-header">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="searchInput"
              placeholder="Search scenarios..."
            />
          </div>
          <div class="filters">
            <button class="filter-btn active" data-filter="all">
              All <span class="count" id="filterAll">0</span>
            </button>
            <button class="filter-btn" data-filter="passed">
              <i class="fas fa-check"></i> Passed
              <span class="count" id="filterPassed">0</span>
            </button>
            <button class="filter-btn" data-filter="failed">
              <i class="fas fa-times"></i> Failed
              <span class="count" id="filterFailed">0</span>
            </button>
            <button class="filter-btn" data-filter="pending">
              <i class="fas fa-clock"></i> Pending
              <span class="count" id="filterPending">0</span>
            </button>
          </div>
        </div>
        <table class="results-table">
          <thead>
            <tr>
              <th>Scenario</th>
              <th>Module</th>
              <th>Feature</th>
              <th>Status</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
        <div class="empty-state" id="emptyState" style="display: none">
          <i class="fas fa-search"></i>
          <h3>No scenarios found</h3>
          <p>Try adjusting your search or filters</p>
        </div>
      </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading test reports...</div>
    </div>

    <script>
      // Global state
      let allFeatures = [];
      let currentFilter = "all";
      let searchQuery = "";

      // Complete module structure from index.html
      const moduleStructure = {
        customerdata: {
          name: "Customer Data",
          icon: "fa-users",
          color: "#6366f1",
          features: [
            "authorization-form",
            "authorization-form-consent",
            "authorization-form-data-use",
            "authorization-form-text",
            "communication-subscription-channel-types",
            "communication-subscriptions",
            "contact-point-type-consent",
            "contact-requests",
            "contacts",
            "customers",
            "data-use-legal-basis",
            "data-use-purpose",
            "individuals",
            "legal-entities",
            "party-consent",
          ],
        },
        finance: {
          name: "Finance",
          icon: "fa-dollar-sign",
          color: "#10b981",
          features: [
            "alternative-payment",
            "financetransactions",
            "payment-authorization",
            "payment-authorization-adjustments",
            "payment-gateway-logs",
            "payments",
            "refund-line-payments",
            "refunds",
          ],
        },
        general: {
          name: "General",
          icon: "fa-globe",
          color: "#64748b",
          features: ["general"],
        },
        inventory: {
          name: "Inventory",
          icon: "fa-boxes",
          color: "#f59e0b",
          features: [
            "assets",
            "inventoryresevations",
            "location-groups",
            "return-order",
            "shipping-carrier-methods",
            "shipping-carriers",
          ],
        },
        marketing: {
          name: "Marketing",
          icon: "fa-bullhorn",
          color: "#ec4899",
          features: [
            "campaign",
            "coupons",
            "engagement-channel-types",
            "promotion-segments",
            "promotions",
          ],
        },
        otherfunctionality: {
          name: "Other Functionality",
          icon: "fa-cog",
          color: "#8b5cf6",
          features: [
            "appointment-categories",
            "appointment-invitations",
            "business-brands",
            "calendar",
            "catalog",
            "categories",
            "consumption-schedules",
            "contracts",
            "files",
            "images",
            "labels",
            "list-emails",
            "operating-hours",
            "process-exceptions",
            "scorecards",
            "shifts",
            "streaming-channels",
            "work-step-templates",
          ],
        },
        platform: {
          name: "Platform",
          icon: "fa-server",
          color: "#14b8a6",
          features: [
            "custom-libraries",
            "dashboards",
            "email-templates",
            "enhanced_letterheads",
            "groups",
            "quick-texts",
            "tasks",
          ],
        },
        sales: {
          name: "Sales",
          icon: "fa-chart-line",
          color: "#3b82f6",
          features: [
            "accounts",
            "leads",
            "opportunities",
            "orders",
            "price-books",
            "products",
            "sellers",
          ],
        },
        service: {
          name: "Service",
          icon: "fa-headset",
          color: "#f97316",
          features: [
            "cases",
            "change-requests",
            "entitlements",
            "incidents",
            "problems",
            "service-appointments",
            "service-resources",
            "service-territories",
            "service_contracts",
            "work-orders",
            "work-plan-templates",
            "work-plans",
            "work-type-groups",
            "work-types",
          ],
        },
      };

      // Initialize
      async function init() {
        try {
          await loadAllReports();
        } catch (error) {
          console.error("Error loading reports:", error);
          // If fetch fails (e.g., file:// protocol), show a message
          showLocalFileMessage();
        }
        setupEventListeners();
        updateTimestamp();
        document.getElementById("loadingOverlay").classList.add("hidden");
      }

      // Show message for local file access
      function showLocalFileMessage() {
        const container = document.getElementById("parentModulesContainer");
        container.innerHTML = `
          <div style="background: var(--bg-card); border-radius: 16px; padding: 2rem; text-align: center; border: 1px solid var(--border-color);">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
            <h3 style="margin-bottom: 1rem;">Local File Access Detected</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
              The dashboard cannot fetch report files when opened directly from the file system.<br>
              Please use one of these options:
            </p>
            <div style="display: flex; flex-direction: column; gap: 1rem; max-width: 500px; margin: 0 auto;">
              <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; text-align: left;">
                <strong>Option 1: Use Live Server</strong><br>
                <code style="color: var(--success);">npx live-server cucumber-reports</code>
              </div>
              <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; text-align: left;">
                <strong>Option 2: Use Python HTTP Server</strong><br>
                <code style="color: var(--success);">python -m http.server 8080</code>
              </div>
              <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; text-align: left;">
                <strong>Option 3: View Individual Reports</strong><br>
                <a href="index.html" style="color: var(--primary);">Open index.html</a> to browse reports manually
              </div>
            </div>
          </div>
        `;
        updateDataBadge(false, 0);
      }

      // Load all reports by fetching each report.html
      async function loadAllReports() {
        allFeatures = [];
        const fetchPromises = [];
        let successCount = 0;
        let failCount = 0;

        for (const [moduleKey, moduleConfig] of Object.entries(
          moduleStructure
        )) {
          for (const feature of moduleConfig.features) {
            const reportPath = `${moduleKey}/${feature}/report.html`;
            fetchPromises.push(
              fetchReportData(reportPath, moduleKey, feature, moduleConfig.name)
                .then(() => successCount++)
                .catch(() => failCount++)
            );
          }
        }

        // Add timeout to prevent infinite loading
        const timeoutPromise = new Promise((_, reject) =>
          setTimeout(() => reject(new Error("Timeout")), 10000)
        );

        try {
          await Promise.race([Promise.all(fetchPromises), timeoutPromise]);
        } catch (error) {
          console.log("Fetch timeout or error, checking results...");
        }

        if (allFeatures.length > 0) {
          updateDataBadge(true, allFeatures.length);
          updateDashboard();
        } else if (failCount > 0 && successCount === 0) {
          // All fetches failed - likely file:// protocol issue
          throw new Error("Cannot fetch reports");
        } else {
          updateDataBadge(false, 0);
          updateDashboard();
        }
      }

      // Fetch and parse individual report.html
      async function fetchReportData(
        reportPath,
        moduleKey,
        featureSlug,
        moduleName
      ) {
        try {
          const response = await fetch(reportPath);
          if (!response.ok) return;

          const html = await response.text();

          // Extract scenario stats from the JavaScript in the HTML
          // Look for: "title": "Scenarios", "failed": X, "passed": Y, ...
          const scenarioMatch = html.match(
            /"title":\s*"Scenarios"[^}]*"failed":\s*(\d+)[^}]*"passed":\s*(\d+)[^}]*"pending":\s*(\d+)[^}]*"skipped":\s*(\d+)/
          );

          let passed = 0,
            failed = 0,
            pending = 0,
            skipped = 0;

          if (scenarioMatch) {
            failed = parseInt(scenarioMatch[1]) || 0;
            passed = parseInt(scenarioMatch[2]) || 0;
            pending = parseInt(scenarioMatch[3]) || 0;
            skipped = parseInt(scenarioMatch[4]) || 0;
          } else {
            // Alternative pattern
            const altMatch = html.match(
              /drawChart\(\{[^}]*"title":\s*"Scenarios"[^}]*\}/g
            );
            if (altMatch) {
              const chartStr = altMatch[0];
              const failedM = chartStr.match(/"failed":\s*(\d+)/);
              const passedM = chartStr.match(/"passed":\s*(\d+)/);
              const pendingM = chartStr.match(/"pending":\s*(\d+)/);
              const skippedM = chartStr.match(/"skipped":\s*(\d+)/);

              failed = failedM ? parseInt(failedM[1]) : 0;
              passed = passedM ? parseInt(passedM[1]) : 0;
              pending = pendingM ? parseInt(pendingM[1]) : 0;
              skipped = skippedM ? parseInt(skippedM[1]) : 0;
            }
          }

          // Also try to find scenario names from the HTML
          const scenarioNames = [];
          const scenarioMatches = html.matchAll(
            /<span class="[^"]*scenario-keyword[^"]*"[^>]*>[^<]*Scenario[^<]*<\/span>\s*<span[^>]*>([^<]+)<\/span>/gi
          );
          for (const match of scenarioMatches) {
            scenarioNames.push(match[1].trim());
          }

          // Format feature name
          const featureName = featureSlug
            .split("-")
            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
            .join(" ")
            .replace(/_/g, " ");

          const total = passed + failed + pending + skipped;

          if (total > 0) {
            allFeatures.push({
              module: moduleKey,
              moduleName: moduleName,
              feature: featureName,
              featureSlug: featureSlug,
              reportPath: reportPath,
              passed: passed,
              failed: failed,
              pending: pending,
              skipped: skipped,
              total: total,
              scenarios: scenarioNames,
            });
          }
        } catch (error) {
          console.log(`Could not load ${reportPath}:`, error.message);
        }
      }

      // Update dashboard
      function updateDashboard() {
        updateStats();
        updateParentModules();
        updateResultsTable();
      }

      // Update stats
      function updateStats() {
        let totalPassed = 0,
          totalFailed = 0,
          totalPending = 0,
          totalSkipped = 0;

        allFeatures.forEach((f) => {
          totalPassed += f.passed;
          totalFailed += f.failed;
          totalPending += f.pending;
          totalSkipped += f.skipped;
        });

        const total = totalPassed + totalFailed + totalPending + totalSkipped;

        document.getElementById("totalTests").textContent = total;
        document.getElementById("passedTests").textContent = totalPassed;
        document.getElementById("failedTests").textContent = totalFailed;
        document.getElementById("pendingTests").textContent = totalPending;
        document.getElementById("skippedTests").textContent = totalSkipped;

        const passedPct =
          total > 0 ? Math.round((totalPassed / total) * 100) : 0;
        const failedPct =
          total > 0 ? Math.round((totalFailed / total) * 100) : 0;

        document.getElementById("passedPercentage").textContent =
          passedPct + "%";
        document.getElementById("failedPercentage").textContent =
          failedPct + "%";

        document.getElementById("filterAll").textContent = total;
        document.getElementById("filterPassed").textContent = totalPassed;
        document.getElementById("filterFailed").textContent = totalFailed;
        document.getElementById("filterPending").textContent = totalPending;
      }

      // Update parent modules with inner modules
      function updateParentModules() {
        const container = document.getElementById("parentModulesContainer");

        // Group features by module
        const moduleData = {};
        allFeatures.forEach((feature) => {
          if (!moduleData[feature.module]) {
            moduleData[feature.module] = {
              name: feature.moduleName,
              total: 0,
              passed: 0,
              failed: 0,
              pending: 0,
              skipped: 0,
              features: [],
            };
          }
          moduleData[feature.module].total += feature.total;
          moduleData[feature.module].passed += feature.passed;
          moduleData[feature.module].failed += feature.failed;
          moduleData[feature.module].pending += feature.pending;
          moduleData[feature.module].skipped += feature.skipped;
          moduleData[feature.module].features.push(feature);
        });

        // Sort modules by name
        const sortedModules = Object.entries(moduleData).sort((a, b) =>
          a[1].name.localeCompare(b[1].name)
        );

        container.innerHTML = sortedModules
          .map(([moduleKey, data]) => {
            const config = moduleStructure[moduleKey] || {
              name: moduleKey,
              icon: "fa-folder",
              color: "#6b7280",
            };
            const innerModuleCount = data.features.length;
            const passRate =
              data.total > 0 ? Math.round((data.passed / data.total) * 100) : 0;

            // Sort features by name
            data.features.sort((a, b) => a.feature.localeCompare(b.feature));

            const innerModulesHtml = data.features
              .map((feature) => {
                const featurePassRate =
                  feature.total > 0
                    ? Math.round((feature.passed / feature.total) * 100)
                    : 0;
                const progressClass =
                  featurePassRate >= 80
                    ? "high"
                    : featurePassRate >= 50
                    ? "medium"
                    : "low";
                const hasFailures = feature.failed > 0;

                return `
                        <div class="inner-module-card ${
                          hasFailures ? "has-failures" : ""
                        }" onclick="openReport('${feature.reportPath}')">
                            <div class="inner-module-header">
                                <span class="inner-module-name"><i class="fas fa-file-code"></i> ${
                                  feature.feature
                                }</span>
                                <div class="inner-module-stats">
                                    <span class="inner-stat passed"><i class="fas fa-check"></i> ${
                                      feature.passed
                                    }</span>
                                    <span class="inner-stat failed"><i class="fas fa-times"></i> ${
                                      feature.failed
                                    }</span>
                                    ${
                                      feature.pending > 0
                                        ? `<span class="inner-stat pending"><i class="fas fa-clock"></i> ${feature.pending}</span>`
                                        : ""
                                    }
                                    ${
                                      feature.skipped > 0
                                        ? `<span class="inner-stat skipped"><i class="fas fa-forward"></i> ${feature.skipped}</span>`
                                        : ""
                                    }
                                </div>
                            </div>
                            <div class="inner-module-progress">
                                <div class="inner-module-progress-fill ${progressClass}" style="width: ${featurePassRate}%"></div>
                            </div>
                            <div class="inner-module-footer">
                                <span>${feature.total} scenarios</span>
                                <span>${featurePassRate}% pass rate</span>
                            </div>
                        </div>
                    `;
              })
              .join("");

            const hasModuleFailures = data.failed > 0;

            return `
                    <div class="parent-module ${
                      hasModuleFailures ? "has-failures" : ""
                    }" id="module-${moduleKey}">
                        <div class="parent-module-header" onclick="toggleModule('${moduleKey}')">
                            <div class="parent-module-info">
                                <div class="parent-module-icon" style="background: ${
                                  config.color
                                }20; color: ${config.color}">
                                    <i class="fas ${config.icon}"></i>
                                </div>
                                <div class="parent-module-details">
                                    <h3>${config.name}</h3>
                                    <div class="parent-module-meta">
                                        <span class="inner-module-count">${innerModuleCount} features</span>
                                        <span>${
                                          data.total
                                        } total scenarios</span>
                                        <span>${passRate}% pass rate</span>
                                    </div>
                                </div>
                            </div>
                            <div class="parent-module-stats">
                                <div class="parent-stat total">
                                    <div class="parent-stat-value">${
                                      data.total
                                    }</div>
                                    <div class="parent-stat-label">Total</div>
                                </div>
                                <div class="parent-stat passed">
                                    <div class="parent-stat-value">${
                                      data.passed
                                    }</div>
                                    <div class="parent-stat-label">Passed</div>
                                </div>
                                <div class="parent-stat failed">
                                    <div class="parent-stat-value">${
                                      data.failed
                                    }</div>
                                    <div class="parent-stat-label">Failed</div>
                                </div>
                                <div class="parent-module-toggle">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                        </div>
                        <div class="inner-modules">
                            <div class="inner-modules-grid">
                                ${innerModulesHtml}
                            </div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      // Toggle module expand/collapse
      function toggleModule(moduleKey) {
        const module = document.getElementById(`module-${moduleKey}`);
        module.classList.toggle("expanded");
      }

      // Open report in new tab
      function openReport(reportPath) {
        window.open(reportPath, "_blank");
      }

      // Update results table
      function updateResultsTable() {
        let filtered = [...allFeatures];

        if (currentFilter !== "all") {
          filtered = filtered.filter((f) => {
            if (currentFilter === "passed") return f.passed > 0;
            if (currentFilter === "failed") return f.failed > 0;
            if (currentFilter === "pending") return f.pending > 0;
            return true;
          });
        }

        if (searchQuery) {
          const query = searchQuery.toLowerCase();
          filtered = filtered.filter(
            (f) =>
              f.feature.toLowerCase().includes(query) ||
              f.moduleName.toLowerCase().includes(query)
          );
        }

        const container = document.getElementById("resultsBody");
        const emptyState = document.getElementById("emptyState");

        if (filtered.length === 0) {
          container.innerHTML = "";
          emptyState.style.display = "block";
          return;
        }

        emptyState.style.display = "none";

        // Generate rows for each feature
        container.innerHTML = filtered
          .map((feature) => {
            const config = moduleStructure[feature.module] || {
              name: feature.module,
            };
            const status =
              feature.failed > 0
                ? "failed"
                : feature.pending > 0
                ? "pending"
                : "passed";
            const passRate =
              feature.total > 0
                ? Math.round((feature.passed / feature.total) * 100)
                : 0;

            return `
                    <tr onclick="openReport('${
                      feature.reportPath
                    }')" style="cursor: pointer;">
                        <td>
                            <div class="scenario-name">
                                <span class="scenario-title">${
                                  feature.feature
                                }</span>
                                <span class="scenario-feature">${
                                  feature.total
                                } scenarios</span>
                            </div>
                        </td>
                        <td><span class="module-tag">${config.name}</span></td>
                        <td>
                            <span style="color: var(--success)"><i class="fas fa-check"></i> ${
                              feature.passed
                            }</span>
                            <span style="color: var(--danger); margin-left: 0.5rem;"><i class="fas fa-times"></i> ${
                              feature.failed
                            }</span>
                        </td>
                        <td>
                            <span class="status-badge ${status}">
                                <i class="fas ${getStatusIcon(status)}"></i>
                                ${passRate}% pass
                            </span>
                        </td>
                        <td style="color: var(--text-secondary)">
                            <a href="${
                              feature.reportPath
                            }" target="_blank" onclick="event.stopPropagation();">
                                <i class="fas fa-external-link-alt"></i> View
                            </a>
                        </td>
                    </tr>
                `;
          })
          .join("");
      }

      function getStatusIcon(status) {
        switch (status) {
          case "passed":
            return "fa-check";
          case "failed":
            return "fa-times";
          case "pending":
            return "fa-clock";
          case "skipped":
            return "fa-forward";
          default:
            return "fa-question";
        }
      }

      function updateDataBadge(isLive, count) {
        const badge = document.getElementById("dataBadge");
        if (isLive && count > 0) {
          badge.innerHTML = `<i class="fas fa-database"></i><span>Live Data (${count} features)</span>`;
          badge.classList.remove("demo");
        } else {
          badge.innerHTML =
            '<i class="fas fa-exclamation-triangle"></i><span>No Reports Found</span>';
          badge.classList.add("demo");
        }
      }

      function updateTimestamp() {
        const now = new Date();
        document.getElementById(
          "timestamp"
        ).innerHTML = `<i class="far fa-clock"></i> ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
      }

      function setupEventListeners() {
        document
          .getElementById("searchInput")
          .addEventListener("input", (e) => {
            searchQuery = e.target.value;
            updateResultsTable();
          });

        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            currentFilter = btn.dataset.filter;
            updateResultsTable();
          });
        });
      }

      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
